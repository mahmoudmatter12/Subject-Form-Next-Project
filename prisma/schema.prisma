// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Student {
  id            String         @id @default(uuid())
  clirkId       String         @unique
  fname         String
  lname         String?
  arabicName    String?
  email         String         @unique
  phoneNumber   String?
  studentId     String         @unique
  imgUrl        String?
  academicGuide academicGuide?
  subjects      Subject[] // Subjects that the student is enrolled in
  submissions   Submission[]
  role          Role           @default(STUDENT)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  onboarded     Boolean        @default(false)

  @@index([clirkId, email, studentId])
  @@map("students") // This is the table name in the database
}

model CGPA {
  id        String @id @default(uuid())
  studentId String @unique
  cgpa      Float

  @@map("cgpa")
}

model Submission {
  id         String    @id @default(uuid())
  studentId  String
  isApproved Boolean   @default(false)
  Student    Student[]

  @@map("submissions")
}

model Subject {
  id            String              @id @default(uuid())
  subjectCode   String              @unique
  name          String
  isOpen        Boolean             @default(false)
  prerequisites String[] // Array of subject IDs that are prerequisites
  status        isPassed            @default(FAILED)
  Student       Student[]

  @@map("subjects")
}


model SubjectSubmission {
  submissionId String
  subjectId    String

  @@id([submissionId, subjectId]) // Composite primary key
  @@map("subject_submissions")
}

enum Role {
  STUDENT
  ADMIN
}

enum isPassed {
  PASSED
  FAILED
  NOT_ENROLLED
}

enum academicGuide {
  DR_HELAL
  DR_SALWA
  DR_SAFAA
  DR_SOHA
  DR_SARA
}
